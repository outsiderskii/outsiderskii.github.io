<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>–¢–æ–ª—å–∫–æ –º—ã</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
/* ===== –ë–ê–ó–ê ===== */
body {
  margin: 0;
  height: 100vh;
  font-family: "Georgia", serif;
  background: radial-gradient(circle at top, #2b0a14, #0a0004);
  color: #fff;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

/* ===== –ß–Å–†–ù–´–ï –°–ï–†–î–ï–ß–ö–ò ===== */
body::after {
  content: "üñ§ üñ§ üñ§ üñ§ üñ§ üñ§ üñ§ üñ§";
  position: fixed;
  inset: 0;
  font-size: 40px;
  opacity: 0.08;
  display: flex;
  flex-wrap: wrap;
  align-content: space-around;
  justify-content: space-around;
  animation: floatHearts 40s linear infinite;
  pointer-events: none;
}

@keyframes floatHearts {
  from { transform: translateY(0); }
  to   { transform: translateY(-200px); }
}

/* ===== –ö–ù–û–ü–ö–ò outside ===== */
#controls {
  display: none;
  padding: 10px;
  background: rgba(0,0,0,0.6);
  gap: 8px;
}
#controls button {
  background: #ff8fab;
  border: none;
  padding: 10px 14px;
  color: #fff;
  cursor: pointer;
}

/* ===== –ß–ê–¢ ===== */
#chat {
  flex: 1;
  display: flex;
  flex-direction: column;
}
#messages {
  flex: 1;
  padding: 15px;
  overflow-y: auto;
}
.message { margin-bottom: 10px; }

/* –æ–±—ã—á–Ω—ã–π –Ω–∏–∫ */
.name {
  color: #ffb3c6;
  font-weight: bold;
}

/* –ù–ï–û–ù–û–í–´–ô outside */
.name.outside {
  color: #ff4fa3;
  text-shadow:
    0 0 5px #ff4fa3,
    0 0 10px #ff4fa3,
    0 0 20px #ff4fa3;
  animation: neonPulse 2s ease-in-out infinite;
}

@keyframes neonPulse {
  0%,100% { opacity: 1; }
  50% { opacity: 0.7; }
}

/* ===== –í–í–û–î ===== */
form {
  display: flex;
  padding: 10px;
  background: rgba(0,0,0,0.4);
}
input {
  flex: 1;
  padding: 10px;
  border: none;
  outline: none;
  font-size: 16px;
  background: #1a050b;
  color: #fff;
}
form button {
  margin-left: 10px;
  background: #ff5c8a;
  border: none;
  padding: 10px 16px;
  color: #fff;
}

/* ===== –°–¶–ï–ù–ê ===== */
#scene {
  display: none;
  flex: 1;
  align-items: center;
  justify-content: center;
  padding: 30px;
}
#sceneBox {
  background: rgba(0,0,0,0.65);
  padding: 30px;
  max-width: 420px;
  text-align: center;
}
#sceneBox img {
  max-width: 100%;
  border-radius: 12px;
  margin-bottom: 15px;
}
.caption {
  font-size: 20px;
  color: #ffb3c6;
}

/* ===== –£–í–ï–î–û–ú–õ–ï–ù–ò–ï ===== */
#notify {
  position: fixed;
  top: 20px;
  left: 50%;
  transform: translateX(-50%);
  background: #ff4fa3;
  padding: 12px 20px;
  color: #fff;
  opacity: 0;
  transition: opacity 0.5s;
}
#notify.show { opacity: 1; }
</style>
</head>

<body>

<div id="notify">–û–Ω–∞ –∑–¥–µ—Å—å üñ§</div>

<div id="controls">
  <button onclick="sendLove()">üíå –õ—é–±–æ–≤—å</button>
  <button onclick="sendPhoto()">üì∏ –í–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏–µ</button>
  <button onclick="backToChat()">‚Ü© –ù–∞–∑–∞–¥</button>
</div>

<div id="chat">
  <div id="messages"></div>
  <form id="form">
    <input id="input" placeholder="–ù–∞–ø–∏—à–∏ —á—Ç–æ-–Ω–∏–±—É–¥—å‚Ä¶">
    <button>‚ù§</button>
  </form>
</div>

<div id="scene">
  <div id="sceneBox"></div>
</div>

<script>
/* ===== FIREBASE CONFIG ===== */
const firebaseConfig = {
apiKey: "AIzaSyAVbw2Ofx8uh_HlJJTwnwDgh9mlxcgmNbE",
¬† authDomain: "outside-c6a21.firebaseapp.com",
¬† databaseURL: "https://outside-c6a21-default-rtdb.firebaseio.com",
¬† projectId: "outside-c6a21",
¬† storageBucket: "outside-c6a21.firebasestorage.app",
¬† messagingSenderId: "629004481458",
¬† appId: "1:629004481458:web:98b01543e0a267c1396aab",
¬† measurementId: "G-01WJ03SS69"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

const room = "only-us";
const usersRef = db.ref(room + "/users");
const messagesRef = db.ref(room + "/messages");
const sceneRef = db.ref(room + "/scene");
const usedRef = db.ref(room + "/used");

/* ===== –õ–û–ì–ò–ù ===== */
const login = prompt("–í–≤–µ–¥–∏ –ª–æ–≥–∏–Ω");
if (!login) document.body.innerHTML = "";

if (login === "outside") {
  document.getElementById("controls").style.display = "flex";
}

/* ===== –¢–û–õ–¨–ö–û –î–í–û–ï + –£–í–ï–î–û–ú–õ–ï–ù–ò–ï ===== */
usersRef.once("value", snap => {
  if (snap.numChildren() >= 100) {
    alert("–≠—Ç–∞ –∫–æ–º–Ω–∞—Ç–∞ —Ç–æ–ª—å–∫–æ –¥–ª—è –¥–≤–æ–∏—Ö.");
    document.body.innerHTML = "";
  } else {
    usersRef.push({ login });
  }
});

usersRef.on("value", snap => {
  if (snap.numChildren() === 2 && login === "outside") {
    const n = document.getElementById("notify");
    n.classList.add("show");
    setTimeout(() => n.classList.remove("show"), 3000);
  }
});

window.addEventListener("beforeunload", () => {
  usersRef.once("value", snap => {
    snap.forEach(child => {
      if (child.val().login === login) child.ref.remove();
    });
  });
});

/* ===== –¢–ï–ö–°–¢–´ (–ë–û–õ–¨–®–ï) ===== */
const loveTexts = [
  "–¢—ã -- –º–æ–π —Å–∞–º—ã–π —Ç—ë–ø–ª—ã–π —Å–ª—É—á–∞–π.",
  "–° —Ç–æ–±–æ–π –º–∏—Ä —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –º—è–≥—á–µ.",
  "–Ø —É–ª—ã–±–∞—é—Å—å, –∫–æ–≥–¥–∞ –¥—É–º–∞—é –æ –Ω–∞—Å.",
  "–¢—ã -- –º–µ—Å—Ç–æ, –≥–¥–µ –º–Ω–µ —Å–ø–æ–∫–æ–π–Ω–æ.",
  "–° —Ç–æ–±–æ–π –¥–∞–∂–µ —Ç–∏—à–∏–Ω–∞ –∑–≤—É—á–∏—Ç –∫—Ä–∞—Å–∏–≤–æ.",
  "–Ø –±—ã –≤—ã–±—Ä–∞–ª —Ç–µ–±—è —Å–Ω–æ–≤–∞.",
  "–ú—ã -- –º–æ–π –ª—é–±–∏–º—ã–π —Å—é–∂–µ—Ç.",
  "–¢—ã –¥–µ–ª–∞–µ—à—å –æ–±—ã—á–Ω—ã–µ –¥–Ω–∏ –æ—Å–æ–±–µ–Ω–Ω—ã–º–∏.",
  "–Ø —Ö—Ä–∞–Ω—é –Ω–∞—Å –∞–∫–∫—É—Ä–∞—Ç–Ω–æ.",
  "–¢—ã -- –º–æ—ë ¬´–≤—Å—ë —Ö–æ—Ä–æ—à–æ¬ª."
];

const photos = [
  { img: "https://a.imgfoto.host/2026/01/06/IMG_1367.jpeg", caption: "–ù–∞–∑–∞–¥ –≤ –ø—Ä–æ—à–ª–æ–µ‚Ä¶" },
  { img: "https://a.imgfoto.host/2026/01/06/IMG_0952.jpeg", caption: "–ü–æ—Å–º–æ—Ç—Ä–∏ –Ω–∞ –Ω–∞—Å —Å—á–∞—Å—Ç–ª–∏–≤—ã—Ö üíã" },
  { img: "https://a.imgfoto.host/2026/01/06/IMG_1370.jpeg", caption: "–≠—Ç–æ—Ç –º–æ–º–µ–Ω—Ç –≤—Å—ë –µ—â—ë –∂–∏–≤—ë—Ç" }
];

/* ===== –ù–ï–ü–û–í–¢–û–†–ï–ù–ò–ï ===== */
async function getUnused(type, array) {
  const snap = await usedRef.child(type).once("value");
  const used = snap.val() || {};
  const available = array.map((item,i)=>({item,i})).filter(x=>!used[x.i]);
  if (!available.length) {
    await usedRef.child(type).remove();
    return getUnused(type,array);
  }
  const c = available[Math.floor(Math.random()*available.length)];
  await usedRef.child(type).child(c.i).set(true);
  return c.item;
}

/* ===== –ö–ù–û–ü–ö–ò outside ===== */
async function sendLove() {
  sceneRef.set({ type:"text", content: await getUnused("texts", loveTexts) });
}
async function sendPhoto() {
  sceneRef.set({ type:"photo", content: await getUnused("photos", photos) });
}
function backToChat() {
  sceneRef.set({ type:"chat" });
}

/* ===== –ß–ê–¢ ===== */
form.onsubmit = e => {
  e.preventDefault();
  if (!input.value.trim()) return;
  messagesRef.push({ login, text: input.value });
  input.value = "";
};

messagesRef.on("child_added", snap => {
  const m = snap.val();
  const d = document.createElement("div");
  d.className = "message";
  d.innerHTML =
    `<span class="name ${m.login==="outside"?"outside":""}">${m.login}:</span> ${m.text}`;
  messages.appendChild(d);
  messages.scrollTop = messages.scrollHeight;
});

/* ===== –°–¶–ï–ù–´ ===== */
sceneRef.on("value", snap => {
  const d = snap.val();
  if (!d) return;
  if (d.type === "chat") {
    scene.style.display="none"; chat.style.display="flex"; return;
  }
  chat.style.display="none"; scene.style.display="flex"; sceneBox.innerHTML="";
  if (d.type==="text") sceneBox.innerHTML=`<p style="font-size:22px;">${d.content}</p><p>üñ§</p>`;
  if (d.type==="photo") sceneBox.innerHTML=`<img src="${d.content.img}"><div class="caption">${d.content.caption}</div>`;
});
</script>

</body>
</html>

