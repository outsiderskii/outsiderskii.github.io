<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>outdev</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
body {
  margin: 0;
  height: 100vh;
  font-family: "Georgia", serif;
  background: radial-gradient(circle at top, #2b0a14, #0a0004);
  color: #fff;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

/* üñ§ –§–û–ù */
body::after {
  content: "üñ§ üñ§ üñ§ üñ§ üñ§ üñ§ üñ§ üñ§";
  position: fixed;
  inset: 0;
  font-size: 40px;
  opacity: 0.08;
  display: flex;
  flex-wrap: wrap;
  align-content: space-around;
  justify-content: space-around;
  animation: floatHearts 40s linear infinite;
  pointer-events: none;
}
@keyframes floatHearts {
  from { transform: translateY(0); }
  to   { transform: translateY(-200px); }
}

/* ===== –ö–ù–û–ü–ö–ò outside ===== */
#controls {
  display: none;
  padding: 10px;
  background: rgba(0,0,0,0.6);
  gap: 8px;
}
#controls button {
  background: #ff8fab;
  border: none;
  padding: 10px 14px;
  color: #fff;
  cursor: pointer;
}

/* ===== –ß–ê–¢ ===== */
#chat {
  flex: 1;
  display: flex;
  flex-direction: column;
}
#messages {
  flex: 1;
  padding: 15px;
  overflow-y: auto;
}
.message { margin-bottom: 10px; }

.name {
  color: #ffb3c6;
  font-weight: bold;
}
.name.outside {
  color: #ff4fa3;
  text-shadow: 0 0 5px #ff4fa3, 0 0 15px #ff4fa3;
}

/* ===== –í–í–û–î ===== */
form {
  display: flex;
  padding: 10px;
  background: rgba(0,0,0,0.4);
}
input {
  flex: 1;
  padding: 10px;
  border: none;
  outline: none;
  font-size: 16px;
  background: #1a050b;
  color: #fff;
}
form button {
  margin-left: 10px;
  background: #ff5c8a;
  border: none;
  padding: 10px 16px;
  color: #fff;
}

/* ===== –°–¶–ï–ù–ê ===== */
#scene {
  display: none;
  flex: 1;
  align-items: center;
  justify-content: center;
  padding: 30px;
}
#sceneBox {
  background: rgba(0,0,0,0.65);
  padding: 30px;
  max-width: 420px;
  text-align: center;
}
#sceneBox img {
  max-width: 100%;
  border-radius: 12px;
}
.caption {
  margin-top: 10px;
  font-size: 20px;
  color: #ffb3c6;
}
</style>
</head>

<body>

<div id="controls">
  <button onclick="sendLove()">üíå –õ—é–±–æ–≤—å</button>
  <button onclick="sendPhoto()">üì∏ –í–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏–µ</button>
  <button onclick="softClear()">‚ú® –ù–æ–≤—ã–π –º–æ–º–µ–Ω—Ç</button>
  <button onclick="backToChat()">‚Ü© –ù–∞–∑–∞–¥</button>
</div>

<div id="chat">
  <div id="messages"></div>
  <form id="form">
    <input id="input" placeholder="–ù–∞–ø–∏—à–∏ —á—Ç–æ-–Ω–∏–±—É–¥—å‚Ä¶">
    <button>‚ù§</button>
  </form>
</div>

<div id="scene">
  <div id="sceneBox"></div>
</div>

<script>
/* ===== FIREBASE CONFIG ===== */
const firebaseConfig = {
  apiKey: "AIzaSyAVbw2Ofx8uh_HlJJTwnwDgh9mlxcgmNbE",
¬† authDomain: "outside-c6a21.firebaseapp.com",
¬† databaseURL: "https://outside-c6a21-default-rtdb.firebaseio.com",
¬† projectId: "outside-c6a21",
¬† storageBucket: "outside-c6a21.firebasestorage.app",
¬† messagingSenderId: "629004481458",
¬† appId: "1:629004481458:web:98b01543e0a267c1396aab",
¬† measurementId: "G-01WJ03SS69"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

const room = "only-us";
const usersRef = db.ref(room + "/users");
const messagesRef = db.ref(room + "/messages");
const sceneRef = db.ref(room + "/scene");
const usedRef = db.ref(room + "/used");
const clearRef = db.ref(room + "/clearedAt");

/* ===== –õ–û–ì–ò–ù ===== */
const login = prompt("–í–≤–µ–¥–∏ –ª–æ–≥–∏–Ω");
if (!login) document.body.innerHTML = "";

if (login === "outside") {
  document.getElementById("controls").style.display = "flex";
}

/* ===== –¢–û–õ–¨–ö–û –î–í–û–ï ===== */
usersRef.once("value", snap => {
  if (snap.numChildren() >= 100) {
    alert("–≠—Ç–∞ –∫–æ–º–Ω–∞—Ç–∞ —Ç–æ–ª—å–∫–æ –¥–ª—è –¥–≤–æ–∏—Ö.");
    document.body.innerHTML = "";
  } else {
    usersRef.push({ login });
  }
});

/* ===== –î–ê–ù–ù–´–ï ===== */
const loveTexts = [
  "–¢—ã -- –º–æ–π —Å–∞–º—ã–π —Ç—ë–ø–ª—ã–π —Å–ª—É—á–∞–π.",
  "–° —Ç–æ–±–æ–π –º–∏—Ä —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –º—è–≥—á–µ.",
  "–Ø —É–ª—ã–±–∞—é—Å—å, –∫–æ–≥–¥–∞ –¥—É–º–∞—é –æ –Ω–∞—Å.",
  "–¢—ã -- –º–µ—Å—Ç–æ, –≥–¥–µ –º–Ω–µ —Å–ø–æ–∫–æ–π–Ω–æ.",
  "–° —Ç–æ–±–æ–π –¥–∞–∂–µ —Ç–∏—à–∏–Ω–∞ –∑–≤—É—á–∏—Ç –∫—Ä–∞—Å–∏–≤–æ.",
  "–Ø –±—ã –≤—ã–±—Ä–∞–ª —Ç–µ–±—è —Å–Ω–æ–≤–∞."
];

const photos = [
  { img: "https://a.imgfoto.host/2026/01/06/IMG_1367.jpeg", caption: "–ù–∞–∑–∞–¥ –≤ –ø—Ä–æ—à–ª–æ–µ‚Ä¶" },
  { img: "https://a.imgfoto.host/2026/01/06/IMG_0952.jpeg", caption: "–ü–æ—Å–º–æ—Ç—Ä–∏ –Ω–∞ –Ω–∞—Å —Å—á–∞—Å—Ç–ª–∏–≤—ã—Ö üíã" },
  { img: "https://a.imgfoto.host/2026/01/06/IMG_1370.jpeg", caption: "–≠—Ç–æ—Ç –º–æ–º–µ–Ω—Ç –≤—Å—ë –µ—â—ë –∂–∏–≤—ë—Ç" }
];

/* ===== –ù–ï–ü–û–í–¢–û–†–ï–ù–ò–ï ===== */
async function getUnused(type, array) {
  const snap = await usedRef.child(type).once("value");
  const used = snap.val() || {};
  const available = array.map((v,i)=>({v,i})).filter(x=>!used[x.i]);
  if (!available.length) {
    await usedRef.child(type).remove();
    return getUnused(type,array);
  }
  const c = available[Math.floor(Math.random()*available.length)];
  await usedRef.child(type).child(c.i).set(true);
  return c.v;
}

/* ===== –ö–ù–û–ü–ö–ò ===== */
async function sendLove() {
  sceneRef.set({ type:"text", content: await getUnused("texts", loveTexts) });
}
async function sendPhoto() {
  sceneRef.set({ type:"photo", content: await getUnused("photos", photos) });
}
function backToChat() {
  sceneRef.set({ type:"chat" });
}
function softClear() {
  if (login !== "outside") return;
  clearRef.set(Date.now());
}

/* ===== –ú–Ø–ì–ö–ê–Ø –û–ß–ò–°–¢–ö–ê ===== */
let clearedAt = 0;
clearRef.on("value", snap => {
  clearedAt = snap.val() || 0;
  messages.innerHTML = "";
});

/* ===== –ß–ê–¢ ===== */
form.onsubmit = e => {
  e.preventDefault();
  if (!input.value.trim()) return;
  messagesRef.push({
    login,
    text: input.value,
    time: Date.now()
  });
  input.value = "";
};

messagesRef.on("child_added", snap => {
  const m = snap.val();
  if (m.time && m.time < clearedAt) return;

  const d = document.createElement("div");
  d.className = "message";
  d.innerHTML =
    `<span class="name ${m.login==="outside"?"outside":""}">${m.login}:</span> ${m.text}`;

  messages.appendChild(d);
  messages.scrollTop = messages.scrollHeight;
});

/* ===== –°–¶–ï–ù–´ ===== */
sceneRef.on("value", snap => {
  const d = snap.val();
  if (!d) return;

  if (d.type === "chat") {
    scene.style.display="none";
    chat.style.display="flex";
    return;
  }

  chat.style.display="none";
  scene.style.display="flex";
  sceneBox.innerHTML="";

  if (d.type==="text") {
    sceneBox.innerHTML = `<p style="font-size:22px;">${d.content}</p><p>üñ§</p>`;
  }
  if (d.type==="photo") {
    sceneBox.innerHTML = `<img src="${d.content.img}"><div class="caption">${d.content.caption}</div>`;
  }
});
</script>

</body>
</html>

